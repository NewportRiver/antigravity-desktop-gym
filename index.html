<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Antigravity Desktop Gym v1.1</title>
    <style>
        :root {
            --bg-color: #0d1117;
            --grid-color: #21262d;
            --text-color: #c9d1d9;
            --target-color: #00ff9d;
            --decoy-color: #ff4444;
            --target-glow: 0 0 15px rgba(0, 255, 157, 0.4);
            --decoy-glow: 0 0 15px rgba(255, 68, 68, 0.4);
        }

        body {
            background-color: var(--bg-color);
            background-image:
                linear-gradient(var(--grid-color) 1px, transparent 1px),
                linear-gradient(90deg, var(--grid-color) 1px, transparent 1px);
            background-size: 40px 40px;
            color: var(--text-color);
            font-family: 'Segoe UI', monospace;
            height: 100vh;
            margin: 0;
            overflow: hidden;
            cursor: crosshair;
            user-select: none;
        }

        #status-panel {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(13, 17, 23, 0.9);
            border: 1px solid var(--grid-color);
            padding: 15px;
            border-radius: 8px;
            width: 250px;
            z-index: 100;
        }

        #log-panel {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(13, 17, 23, 0.9);
            border: 1px solid var(--grid-color);
            padding: 15px;
            border-radius: 8px;
            width: 400px;
            height: 200px;
            overflow-y: auto;
            font-size: 12px;
            z-index: 100;
        }

        .row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .target {
            position: absolute;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(0, 255, 157, 0.1);
            border: 2px solid var(--target-color);
            box-shadow: var(--target-glow);
            transform: translate(-50%, -50%);
            transition: background 0.1s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .target::after {
            content: '';
            width: 4px;
            height: 4px;
            background: white;
            border-radius: 50%;
        }

        .target.hit {
            background: var(--target-color) !important;
            box-shadow: 0 0 30px var(--target-color);
        }

        .target.decoy {
            border-color: var(--decoy-color);
            background: rgba(255, 68, 68, 0.1);
            box-shadow: var(--decoy-glow);
        }

        .target.decoy.hit {
            background: var(--decoy-color) !important;
        }

        /* Mode: Snipe (Small) */
        .target.small {
            width: 15px;
            height: 15px;
        }

        /* Mode: Moving */
        @keyframes float {
            0% {
                transform: translate(-50%, -50%) translate(0, 0);
            }

            25% {
                transform: translate(-50%, -50%) translate(100px, 50px);
            }

            50% {
                transform: translate(-50%, -50%) translate(0, 100px);
            }

            75% {
                transform: translate(-50%, -50%) translate(-100px, 50px);
            }

            100% {
                transform: translate(-50%, -50%) translate(0, 0);
            }
        }

        .target.moving {
            animation: float 4s infinite linear;
        }

        button {
            background: var(--grid-color);
            border: 1px solid var(--text-color);
            color: var(--text-color);
            padding: 5px 10px;
            cursor: pointer;
            margin-top: 10px;
        }

        button:hover {
            background: #30363d;
        }
    </style>
</head>

<body>

    <div id="status-panel">
        <div class="row"><strong>STATUS</strong> <span id="state">READY</span></div>
        <div class="row"><strong>MODE</strong> <select id="mode-select" onchange="setMode()">
                <option value="standard">Standard</option>
                <option value="precision">Precision (Small)</option>
                <option value="reflex">Reflex (Timer)</option>
                <option value="chaos">Chaos (Decoys)</option>
            </select></div>
        <div class="row">Score: <span id="score">0</span></div>
        <div class="row">Last TTH: <span id="latency">--</span> ms</div>
        <div class="row">Mouse: <span id="mouse-pos">0, 0</span></div>
        <button onclick="resetGym()">Reset Gym</button>
    </div>

    <div id="log-panel" id="logs"></div>

    <script>
        let score = 0;
        let activeTarget = null;
        let spawnTime = 0;
        let currentMode = 'standard';

        function log(msg, type = 'info') {
            const panel = document.getElementById('log-panel');
            const color = type === 'error' ? '#ff6b6b' : (type === 'success' ? '#00ff9d' : '#8b949e');
            const time = new Date().toLocaleTimeString();
            panel.innerHTML = `<div style="color:${color}">[${time}] ${msg}</div>` + panel.innerHTML;
        }

        function setMode() {
            currentMode = document.getElementById('mode-select').value;
            log(`Mode switched to: ${currentMode.toUpperCase()}`);
            spawnTarget();
        }

        document.addEventListener('mousemove', (e) => {
            document.getElementById('mouse-pos').innerText = `${e.clientX}, ${e.clientY}`;
        });

        function spawnTarget() {
            if (activeTarget) activeTarget.remove();

            // Dimensions
            const padding = 100;
            const w = window.innerWidth - padding * 2;
            const h = window.innerHeight - padding * 2;
            const x = Math.floor(Math.random() * w) + padding;
            const y = Math.floor(Math.random() * h) + padding;

            const el = document.createElement('div');
            el.classList.add('target');
            el.style.left = x + 'px';
            el.style.top = y + 'px';

            // Mode Logic
            const isDecoy = (currentMode === 'chaos' && Math.random() > 0.7);

            if (isDecoy) {
                el.classList.add('decoy');
                el.dataset.type = 'decoy';
            } else {
                el.dataset.type = 'target';
            }

            if (currentMode === 'precision' || (currentMode === 'chaos' && Math.random() > 0.5)) {
                el.classList.add('small');
            }

            if (currentMode === 'chaos' && Math.random() > 0.5) {
                el.classList.add('moving');
            }

            el.dataset.cx = x;
            el.dataset.cy = y;

            el.addEventListener('mousedown', (e) => handleHit(e, el));
            document.body.appendChild(el);

            activeTarget = el;
            spawnTime = performance.now();

            log(`Spawned ${isDecoy ? 'DECOY' : 'TARGET'} at ${x}, ${y}`);
        }

        function handleHit(e, el) {
            const reactionTime = Math.round(performance.now() - spawnTime);
            document.getElementById('latency').innerText = reactionTime;

            const rect = el.getBoundingClientRect();
            // Calculate center of element (handle moving targets)
            const centerX = rect.left + rect.width / 2;
            const centerY = rect.top + rect.height / 2;

            const dist = Math.sqrt(Math.pow(e.clientX - centerX, 2) + Math.pow(e.clientY - centerY, 2));

            if (el.dataset.type === 'decoy') {
                score -= 5;
                el.classList.add('hit');
                log(`ðŸš« HIT DECOY! Penalty. (Offset: ${dist.toFixed(1)}px)`, 'error');
                setTimeout(spawnTarget, 500);
            } else {
                score++;
                el.classList.add('hit');
                log(`ðŸŽ¯ HIT! TTH: ${reactionTime}ms | Offset: ${dist.toFixed(1)}px`, 'success');
                setTimeout(spawnTarget, 500); // Quick respawn
            }

            document.getElementById('score').innerText = score;
        }

        document.body.addEventListener('mousedown', (e) => {
            if (!e.target.classList.contains('target')) {
                log(`MISS at ${e.clientX}, ${e.clientY}`, 'error');
            }
        });

        function resetGym() {
            score = 0;
            document.getElementById('score').innerText = 0;
            log('Gym Initialized. Waiting for agent...');
            spawnTarget();
        }

        // Init
        // Wait for viewport to stabilize
        setTimeout(resetGym, 1000);

    </script>
</body>

</html>